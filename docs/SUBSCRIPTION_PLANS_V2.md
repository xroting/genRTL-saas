# è®¢é˜…è®¡åˆ’é‡æ„å®Œæˆæ€»ç»“

## ğŸ“Š æ–°è®¢é˜…è®¡åˆ’æ¶æ„

### è®¡åˆ’å¯¹æ¯”è¡¨

| è®¡åˆ’ | æœˆè´¹ | Included USD | æ˜ å°„æ¯”ä¾‹ | Tokens ä¸Šé™ | On-Demand | ä½¿ç”¨æ¨¡å‹ | è´¹ç‡/1K tokens |
|------|------|-------------|----------|------------|-----------|----------|---------------|
| **Free** | $0 | $0.5 | N/A | 1M | âŒ ç¦ç”¨ | Claude Haiku 3 | $0.00025 |
| **Basic** | $20 | $30 | 1:1.5 | æ— é™ | âœ… å…è®¸ | Claude Sonnet 4 | $0.009 |
| **Plus** | $100 | $150 | 1:1.5 | æ— é™ | âœ… å…è®¸ | Claude Sonnet 4 | $0.0081 (-10%) |
| **Ultra Plus** | $200 | $300 | 1:1.5 | æ— é™ | âœ… å…è®¸ | Claude Sonnet 4 | $0.0075 (-20%) |

### æ¨¡å‹é…ç½®

1. **Free æ¡£ - Claude Haiku 3**
   - æ¨¡å‹ID: `claude-3-haiku-20240307`
   - Input: $0.00025/1K tokens
   - Output: $0.00125/1K tokens
   - ç‰¹ç‚¹ï¼šè¶…ä½æˆæœ¬ï¼Œé€‚åˆå…è´¹ç”¨æˆ·

2. **ä»˜è´¹æ¡£ - Claude Sonnet 4**
   - æ¨¡å‹ID: `claude-sonnet-4-20250514`
   - Input: $0.003/1K tokens
   - Output: $0.015/1K tokens
   - ç‰¹ç‚¹ï¼šé«˜æ€§èƒ½ï¼Œé«˜è´¨é‡è¾“å‡º

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. è®¢é˜…è®¡åˆ’é…ç½® (`lib/cbb/usd-pool.ts`)

```typescript
export const SUBSCRIPTION_PLANS = {
  free: {
    price_usd: 0,
    included_usd: 0.5,
    on_demand_allowed: false,
    llm_rates: { ... }  // Haiku è´¹ç‡
  },
  basic: {
    price_usd: 20,
    included_usd: 30,    // 1.5x
    on_demand_allowed: true,
    llm_rates: { ... }  // Sonnet è´¹ç‡
  },
  // ... plus, ultra_plus
}
```

### 2. æ¨¡å‹é€‰æ‹©é€»è¾‘ (`app/api/chat/route.ts`)

```typescript
function getModelForPlan(planName: string): string {
  if (planName === 'free' || planName === 'hobby') {
    return 'claude-3-haiku-20240307';  // Haiku 3
  }
  return 'claude-sonnet-4-20250514';   // Sonnet 4
}
```

### 3. è‡ªåŠ¨æ¨¡å‹åˆ‡æ¢

- ç³»ç»Ÿæ ¹æ®ç”¨æˆ·è®¢é˜…è®¡åˆ’è‡ªåŠ¨é€‰æ‹©æ¨¡å‹
- Free ç”¨æˆ·åªèƒ½ä½¿ç”¨ Haiku 3
- ä»˜è´¹ç”¨æˆ·ä½¿ç”¨ Sonnet 4
- æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š`ğŸ“‹ User plan: free, selected model: claude-3-haiku-20240307`

## ğŸ“ æ•°æ®åº“è¿ç§»

### è¿ç§»æ–‡ä»¶: `005_update_subscription_plans.sql`

æ‰§è¡Œå†…å®¹ï¼š
1. æ›´æ–°è®¡åˆ’åç§°æ˜ å°„
2. è°ƒæ•´ USD Pool é¢åº¦ï¼ˆæŒ‰ 1.5:1ï¼‰
3. ä¸º Free æ¡£ç¦ç”¨ on_demand

**æ‰§è¡Œå‘½ä»¤**:
åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œè¯¥æ–‡ä»¶å†…å®¹ã€‚

## âœ… æµ‹è¯•æ¸…å•

### Free æ¡£æµ‹è¯•
- [ ] æ–°ç”¨æˆ·æ³¨å†Œï¼Œè‡ªåŠ¨åˆ›å»º free è®¡åˆ’
- [ ] USD Pool åˆå§‹åŒ–ä¸º $0.5
- [ ] å‘é€ Chat è¯·æ±‚ï¼Œä½¿ç”¨ Claude Haiku 3
- [ ] æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ¨¡å‹ï¼š`claude-3-haiku-20240307`
- [ ] ä½™é¢ä¸è¶³æ—¶æ‹’ç»è¯·æ±‚ï¼ˆon_demand ç¦ç”¨ï¼‰
- [ ] Dashboard æ˜¾ç¤ºæ­£ç¡®çš„è´¹ç”¨å’Œ tokens

### Basic æ¡£æµ‹è¯•
- [ ] å‡çº§åˆ° Basic è®¡åˆ’
- [ ] USD Pool æ›´æ–°ä¸º $30
- [ ] å‘é€ Chat è¯·æ±‚ï¼Œä½¿ç”¨ Claude Sonnet 4
- [ ] æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ¨¡å‹ï¼š`claude-sonnet-4-20250514`
- [ ] ä½™é¢ä¸è¶³æ—¶å¯ä½¿ç”¨ on_demandï¼ˆå¦‚æœå¼€å¯ï¼‰
- [ ] Dashboard æ˜¾ç¤ºæ­£ç¡®çš„è´¹ç”¨å’Œ tokens

### Plus/Ultra Plus æ¡£æµ‹è¯•
- [ ] å‡çº§æµ‹è¯•ï¼ŒéªŒè¯é¢åº¦æ­£ç¡®ï¼ˆ$150 / $300ï¼‰
- [ ] éªŒè¯è´¹ç‡æŠ˜æ‰£ï¼ˆ10% / 20%ï¼‰
- [ ] éªŒè¯ Sonnet 4 æ¨¡å‹ä½¿ç”¨
- [ ] éªŒè¯ on_demand åŠŸèƒ½

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**
   ```sql
   -- åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
   -- supabase/migrations/005_update_subscription_plans.sql
   ```

2. **é‡å¯åç«¯æœåŠ¡**
   ```bash
   # é‡å¯ Next.js æœåŠ¡
   npm run dev  # æˆ– pm2 restart
   ```

3. **éªŒè¯é…ç½®**
   - æ£€æŸ¥æ—¥å¿—è¾“å‡º
   - æµ‹è¯•å„ä¸ªè®¡åˆ’çš„åŠŸèƒ½
   - ç¡®è®¤æ¨¡å‹è‡ªåŠ¨åˆ‡æ¢

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æˆæœ¬ä¼˜åŒ–
- Free ç”¨æˆ·ä½¿ç”¨ Haikuï¼šæˆæœ¬é™ä½ **92%**ï¼ˆ$0.00025 vs $0.003ï¼‰
- ä»˜è´¹ç”¨æˆ·ä½¿ç”¨ Sonnet 4ï¼šä¿æŒé«˜è´¨é‡è¾“å‡º
- 1.5:1 æ˜ å°„ï¼šæå‡ç”¨æˆ·ä»·å€¼æ„ŸçŸ¥

### ç”¨æˆ·ä½“éªŒ
- Free ç”¨æˆ·ï¼šä½æˆæœ¬ä½¿ç”¨ï¼Œé€‚åˆå°è¯•
- Basic ç”¨æˆ·ï¼š50% é¢å¤–é¢åº¦ï¼ˆ$30 vs $20ï¼‰
- Plus ç”¨æˆ·ï¼š50% é¢å¤–é¢åº¦ï¼ˆ$150 vs $100ï¼‰
- Ultra Plus ç”¨æˆ·ï¼š50% é¢å¤–é¢åº¦ + æœ€ä¼˜è´¹ç‡

### å•†ä¸šæ¨¡å¼
- Free â†’ ä»˜è´¹è½¬åŒ–åŠ¨åŠ›ï¼šæ›´å¥½çš„æ¨¡å‹ï¼ˆSonnet 4ï¼‰
- æ¸…æ™°çš„ä»·å€¼é˜¶æ¢¯ï¼šFree < Basic < Plus < Ultra Plus
- çµæ´»çš„ on_demandï¼šä»˜è´¹ç”¨æˆ·è¶…é¢æ— å¿§

## ğŸ” ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ï¼š
1. Free æ¡£ç”¨æˆ·çš„å¹³å‡ tokens æ¶ˆè€—
2. Free â†’ Basic çš„è½¬åŒ–ç‡
3. å„æ¡£ä½çš„ on_demand ä½¿ç”¨ç‡
4. Haiku vs Sonnet çš„æˆæœ¬å¯¹æ¯”
5. ç”¨æˆ·æ»¡æ„åº¦å’Œç•™å­˜ç‡

---

**é‡æ„å®Œæˆæ—¶é—´**: 2026-01-25
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œå¾…éƒ¨ç½²æµ‹è¯•

